# 20210903 Friday GNU, Guix, Hurd -*- mode: org; -*-
* Feeding a machine into the service
[[https://ci.guix.gnu.org/build/579628/details][Number 579628]], a hurd barebones that was build just 18 hours ago.  Let's start here.
(That is for download, for now on [[https://ci.guix.gnu.org/download/74]])
# C-c C-, (org-insert-structure-template)
** Download
#+begin_src sh :tangle Fn/wget-579628
wget-579628 () 
{ 
    local D="hurd-barebones.qcow2 of 314.8MiB";
    wget https://ci.guix.gnu.org/download/74
}
#+end_src
# /srv/Ha-1/store/3kxzrwfsyw990lnnjq6mlvs9k8l3gkg8-hurd-barebones.qcow2
** Start
#+begin_src sh :tangle Fn/q-hurd-vm
q-hurd-vm () 
{ 
    local D="Start the Guix/GNU/Hurd machine";
    local PORT="22004";
    local SNAPSHOT="";
    local DO="";
    test "$1" = "-snapshot" && SNAPSHOT="$1" && shift;
    test "$1" = "-echo" && DO="echo" && shift;
    local a="-m 512 --enable-kvm ${SNAPSHOT}";
    local b="-device rtl8139,netdev=net0";
    local c="-netdev user,id=net0,hostfwd=tcp:127.0.0.1:${PORT}-:2222";
    local d="-drive file=./store/hurd-vm-disk-image.img,format=qcow2,cache=writeback";
    local e="-serial ${1:-/dev/tty13}";
    test -n "$1" && shift;
    local f="-monitor ${1:-/dev/tty14}";
    test -n "$1" && shift;
    local g="$( until test -z "$1";do echo "$1";shift;done; )";
    ${DO} ${DO_SUDO:-sudo} qemu-system-i386 ${a} ${b} ${c} ${d} ${e} ${f} ${g}
}
#+end_src
** Connect
#+begin_src sh :tangle Fn/ssh-hurd-vm
ssh-hurd-vm () 
{ 
    local D="Connect to the Hurd VM on 22004";
    local a="ssh -p 22004 ${1:-root}@localhost";
    ${a} 2> /dev/null || guix environment --ad-hoc openssh-sans-x -- ${a}
}
#+end_src
** See here
   [[./i/0.jpg]]
