#20210824 (waiting for Guix) -*- mode: org; -*-
* Device Trees and Overlays
** A fragment
#+BEGIN_SRC dts :tangle "./@/0/0-overlay.dts"
/dts-v1/;
/plugin/;

/ {
    compatible = "bcrm,bcm2835";

    fragment@0 {
      target = <&i2s>;
      __overlay__ {
        status = "okay";
        a = <&a_>;
        a_: a__ {
          b;
        };
      };
    };
};
#+END_SRC
** Compile it
#+BEGIN_SRC sh :tangle "./@/0/Fn/0-compile"
0-compile() {
  local D="Compile the device tree overlay, \$1"
  ${DO:-echo} dtc -@ -Hepapr -I dts -O dtb -o ${1:-0}.dtbo ${1:-0}-overlay.dts
  }
#+END_SRC
# C-c C-v C-t  to tangle the included code fragments
** See this
#+BEGIN_EXAMPLE
00000000  d0 0d fe ed 00 00 01 dc  00 00 00 38 00 00 01 b0  |...........8....|
00000010  00 00 00 28 00 00 00 11  00 00 00 10 00 00 00 00  |...(............|
00000020  00 00 00 2c 00 00 01 78  00 00 00 00 00 00 00 00  |...,...x........|
00000030  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 00  |................|
00000040  00 00 00 03 00 00 00 0d  00 00 00 00 62 63 72 6d  |............bcrm|
00000050  2c 62 63 6d 32 38 33 35  00 00 00 00 00 00 00 01  |,bcm2835........|
00000060  66 72 61 67 6d 65 6e 74  40 30 00 00 00 00 00 03  |fragment@0......|
00000070  00 00 00 04 00 00 00 0b  ff ff ff ff 00 00 00 01  |................|
00000080  5f 5f 6f 76 65 72 6c 61  79 5f 5f 00 00 00 00 03  |__overlay__.....|
00000090  00 00 00 05 00 00 00 12  6f 6b 61 79 00 00 00 00  |........okay....|
000000a0  00 00 00 03 00 00 00 04  00 00 00 19 00 00 00 01  |................|
000000b0  00 00 00 01 61 5f 5f 00  00 00 00 03 00 00 00 00  |....a__.........|
000000c0  00 00 00 1b 00 00 00 03  00 00 00 04 00 00 00 1d  |................|
000000d0  00 00 00 01 00 00 00 02  00 00 00 02 00 00 00 02  |................|
000000e0  00 00 00 01 5f 5f 73 79  6d 62 6f 6c 73 5f 5f 00  |....__symbols__.|
000000f0  00 00 00 03 00 00 00 1c  00 00 00 25 2f 66 72 61  |...........%/fra|
00000100  67 6d 65 6e 74 40 30 2f  5f 5f 6f 76 65 72 6c 61  |gment@0/__overla|
00000110  79 5f 5f 2f 61 5f 5f 00  00 00 00 02 00 00 00 01  |y__/a__.........|
00000120  5f 5f 66 69 78 75 70 73  5f 5f 00 00 00 00 00 03  |__fixups__......|
00000130  00 00 00 15 00 00 00 28  2f 66 72 61 67 6d 65 6e  |.......(/fragmen|
00000140  74 40 30 3a 74 61 72 67  65 74 3a 30 00 00 00 00  |t@0:target:0....|
00000150  00 00 00 02 00 00 00 01  5f 5f 6c 6f 63 61 6c 5f  |........__local_|
00000160  66 69 78 75 70 73 5f 5f  00 00 00 00 00 00 00 01  |fixups__........|
00000170  66 72 61 67 6d 65 6e 74  40 30 00 00 00 00 00 01  |fragment@0......|
00000180  5f 5f 6f 76 65 72 6c 61  79 5f 5f 00 00 00 00 03  |__overlay__.....|
00000190  00 00 00 04 00 00 00 19  00 00 00 00 00 00 00 02  |................|
000001a0  00 00 00 02 00 00 00 02  00 00 00 02 00 00 00 09  |................|
000001b0  63 6f 6d 70 61 74 69 62  6c 65 00 74 61 72 67 65  |compatible.targe|
000001c0  74 00 73 74 61 74 75 73  00 61 00 62 00 70 68 61  |t.status.a.b.pha|
000001d0  6e 64 6c 65 00 61 5f 00  69 32 73 00              |ndle.a_.i2s.|
000001dc
#+END_EXAMPLE

# fdtdump bcm2708-rpi-zero-w.dtb
